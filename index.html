<!DOCTYPE html>
<html>
  <head>
    <title>Mammoth</title>
    <link rel="stylesheet" type="text/css" href="static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="static/style.css">
  </head>
  <body>
    <div class="banner">
      <div class="container">
        <h1><a href="/">Mammoth</a></h1>
      </div>
    </div>
    <div class="container">
      <input id="document" type="file" />
      <div id="output">
      </div>
    </div>
    
    <script src="static/jszip/jszip.js"></script>
    <script src="static/jszip/jszip-deflate.js"></script>
    <script src="static/jszip/jszip-inflate.js"></script>
    <script src="static/jszip/jszip-load.js"></script>
    <script src="bundle.js"></script>
    <script>
    (function() {
        var mammoth = MAMMOTH.mammoth;
        var q = MAMMOTH.q;
        var Buffer = MAMMOTH.Buffer;
        
        var converter = new mammoth.Converter(mammoth.standardOptions);
        function handleFileSelect(event) {
            var files = event.target.files;

            for (var i = 0; i < files.length; i++) {
                var file = files[i];
                var reader = new FileReader();
                
                reader.onload = function(loadEvent) {
                    var arrayBuffer = loadEvent.target.result;
                    converter.convertToHtml({file: openFile(arrayBuffer)})
                        .then(function(result) {
                            document.getElementById("output").innerHTML = result.html;
                        })
                        .done();
                };
                
                
                reader.readAsArrayBuffer(file);
            }
            
            function openFile(arrayBuffer) {
                var zipFile = new JSZip(arrayBuffer);
                function exists(name) {
                    return zipFile.file(name) !== null;
                }
                
                function read(name, encoding) {
                    var array = zipFile.file(name).asUint8Array();
                    var buffer = new Buffer(array);
                    if (encoding) {
                        return q.when(buffer.toString(encoding));
                    } else {
                        return q.when(buffer);
                    }
                }
                return {
                    exists: exists,
                    read: read
                };
            }
        }
          
        document.getElementById("document").addEventListener('change', handleFileSelect, false);
    })();
    </script>
  </body>
</html>

